/*  
 * cli_guide plugin 
 * Original author: @willrre 
 * Further changes, comments: @willrre 
 * Licensed under the MIT license 
 */

!function(e,t,n,s){function o(t,n,o){var i="";return e.ajaxSetup({async:!1}),e.getJSON(t,function(t){e.each(t,function(t,a){e.each(a,function(e,t){for(var a=0;a<t.length;a++)if(t[a].command!==s){if(Array.isArray(t[a].command))for(var l=0;l<t[a].command.length;l++)if(n.trim()==t[a].command[l]&&t[a].type!==s)if("animation"===t[a].type){for(var c=[],r=0;r<t[a].result.length;r++)c.push("<div id="+o+' class="cline">'+t[a].result[r]+"</div>");i=c}else i=t[a].result;if(t[a].command===n.trim()&&t[a].result!==s&&t[a].type!==s)if("animation"===t[a].type){for(var d=[],r=0;r<t[a].result.length;r++)d.push("<div id="+o+' class="cline">'+t[a].result[r]+"</div>");i=d}else i=t[a].result}})})}),i}function a(t){e.getJSON(t,function(t){e.each(t,function(t,n){e.each(n,function(e,t){for(var o=0;o<t.length;o++)if(Array.isArray(t[o].command))for(var i=0;i<t[o].command.length;i++)localStorage.removeItem("step-"+t[o].command[i]),localStorage.setItem("step-"+t[o].command[i],JSON.stringify({step:n.step,command:t[o].command[i],type:t[o].type,depend:t[o].depend,done:!1,animation:t[o].animation!==s&&t[o].animation,lastCommand:t[o].lastCommand!==s&&t[o].lastCommand}));else localStorage.removeItem("step-"+t[o].command),localStorage.setItem("step-"+t[o].command,JSON.stringify({step:n.step,command:t[o].command,type:t[o].type,depend:t[o].depend,done:!1,animation:t[o].animation!==s&&t[o].animation,lastCommand:t[o].lastCommand!==s&&t[o].lastCommand}))})})})}function l(t){var n=[];e.ajaxSetup({async:!1}),e.getJSON(t,function(t){e.each(t,function(t,o){e.each(o,function(e,t){for(var o=0;o<t.length;o++)if(Array.isArray(t[o].command))for(var i=0;i<t[o].command.length;i++)t[o].command!==s&&n.push(t[o].command[i]);else t[o].command!==s&&n.push(t[o].command)})})}),localStorage.setItem("commands",n)}function c(t,n){this.element=t,this.options=e.extend({},w,n),this._defaults=w,this._name=S,this.init()}var r=(e("#terminal"),[]),d={insertAt:function(e,t,n){return e.substr(0,t)+n+" "+e.substr(t)},removeItemFromArray:function(e,t){for(var n in e)if(e[n]==t){e.splice(n,1);break}},placeCaretAtEnd:function(e){if(e.focus(),"undefined"!=typeof t.getSelection&&"undefined"!=typeof n.createRange){var s=n.createRange();s.selectNodeContents(e),s.collapse(!1);var o=t.getSelection();o.removeAllRanges(),o.addRange(s)}else if("undefined"!=typeof n.body.createTextRange){var i=n.body.createTextRange();i.moveToElementText(e),i.collapse(!1),i.select()}}},m={loadSteps:function(t){localStorage.setItem("stepsFile",!1),""!==t&&localStorage.setItem("stepsFile",!0),e.getJSON(t,function(t){e.each(t,function(e,t){t.laststep&&localStorage.setItem("laststep",t.step),localStorage.setItem(t.content.step,JSON.stringify({step:t.content.step,title:t.content.title,body:t.content.body,moreinfo:t.content.moreinfo===s?"":t.content.moreinfo,commands:t.content.commands,done:!1}))})})},loadCommands:function(t){localStorage.setItem("commandStepsFile",!1),""!==t&&localStorage.setItem("commandStepsFile",!0),e.getJSON(t,function(t){e.each(t,function(e,t){localStorage.setItem(t.command,JSON.stringify({command:t.command,step:t.step,type:t.type,result:t.result}))})})}},p={list:function(t){""!==t?e.getJSON(t,function(t){e.each(t,function(e,t){p.listTemplate(t.step)})}):p.listTemplate(1)},showInfo:function(e){if(null!==localStorage.getItem(e)){var t=JSON.parse(localStorage.getItem(e));p.showInfoTemplate(t.step,t.title,t.body,t.commands,t.moreinfo)}},getLast:function(){return localStorage.getItem("laststep")},clean:function(t){e.getJSON(t,function(t){e.each(t,function(e,t){localStorage.removeItem(t.step),localStorage.setItem(t.step,!1)})})},skip:function(t){var n=JSON.parse(localStorage.getItem(t));localStorage.setItem(t,JSON.stringify({step:n.step,title:n.title,body:n.body,moreinfo:n.moreinfo===s?"":n.moreinfo,commands:n.commands,done:!0}));var o=t+1;p.showInfo(o),e("#"+o).removeClass("not-active"),e("#"+t+".btn-step").css({"background-color":"#8F8F8F",color:"white",border:"1px solid #525252"})},listTemplate:function(t){var n=1==t?"":"not-active";console.log(t),e("#listofsteps").append('<li class="step"><a id="'+t+'" class="btn-step '+n+'" href="#" data-step="'+t+'">'+t+"</a></li>")},showInfoTemplate:function(t,n,o,i,a){var l=parseInt(t)+1>p.getLast()?p.getLast():parseInt(t)+1,c=[],r="";""!=localStorage.getItem("skipsteps")&&(c=localStorage.getItem("skipsteps").split(","),c[t-1]!==s&&(r='<a href="#" id="skip" class="skip-b" data-step="'+t+'">Skip</a>')),e("#stepscontent").html("");var d=t===p.getLast()?"Finish ✓":"Next ✓";e("#steptitle").html("<h3>"+n+r+'<a href="#" id="btn_next_finish" class="next_finish" data-nextstep="'+l+'" data-step="'+t+'">'+d+"</a></h3>");var m=Array.isArray(o)?o.join(""):o;e("#stepscontent").append("<p>"+m+"</p>"),i.length>0&&Array.isArray(i)&&(e("#stepscontent").append('<ul id="listofcommands"></ul>'),e.each(i,function(t,n){e("#listofcommands").append('<li> <span class="promptlabel">$ </span><span class="command">'+n.command+"</span></li>")})),""!==a&&(a=Array.isArray(a)?a.join(""):a,f.showInfo("moreinfo",a)),e("#stepscontent").append('<div id="contentimgmodal"><div>'),e(".next_finish").hide()}};e(n).on("click",".command",function(){e("#"+x+".textinline").text(e(this).text()),d.placeCaretAtEnd(e("#"+x+".textinline").get(0))});var h={newline:function(t,n){var s=e("#terminal");r.push(t),localStorage.setItem("loghistory",r);var o="",i=n;"cd "==t.substring(0,3)&&""!==t.substring(3,t.length)&&(e("#"+n+".response").html(""),localStorage.setItem("actualdir","/"+t.substring(3,t.length))),"cd .."==t&&(e("#"+n+".response").html(""),localStorage.setItem("actualdir","")),o=localStorage.getItem("actualdir"),s.append('<div id="'+i+'" class="parent-textinline"><div class="prompt">you@tutorial:~'+o+'$ </div><div id="'+i+'" spellcheck="false" class="textinline" style="outline-color:black" contenteditable="true">&nbsp;</div></div>'),e("[contenteditable]",s)[0].focus()},result:function(e,t){var n="";if(null!==localStorage.getItem(e)){var s=JSON.parse(localStorage.getItem(e)),o=JSON.parse(localStorage.getItem(s.step)),i=o.commands;for(var a in i)if(i[a].command===e){i[a].done=!0;break}localStorage.setItem(s.step,JSON.stringify({step:o.step,title:o.title,body:o.body,moreinfo:o.moreinfo,commands:o.commands,done:!1}));var l=[];if("animation"===s.type){for(var a=0;a<s.result.length;a++)l.push("<div id="+t+' class="cline">'+s.result[a]+"</div>");n=l}else n=s.result;return n}return n},ls:function(t){e("#"+t+".response").html(localStorage.getItem("files").split(",").join(" "))},clear:function(t,n){e(".parent-textinline").remove(),e(".response").remove(),localStorage.setItem("idinput",0),h.newline(t,0)},rm:function(e){if(null!==localStorage.getItem(e)){var t=localStorage.getItem("files").split(",");t=t.filter(Boolean),d.removeItemFromArray(t,e),localStorage.setItem("files",t),localStorage.removeItem(e)}},gitClone:function(t,n){if(e("#"+n+".response").html(""),g.gitClone(t.replace(/\s\s+/g," "))){var s=t.split(" ").pop(),o=s.substring(s.lastIndexOf("/")+1,s.lastIndexOf(".git"));e("#"+n+".response").append("Cloning into '"+o+"'... <br/>"),e("#"+n+".response").append("remote: Counting objects: 4643, done.<br/>"),e("#"+n+".response").append('remote: Compressing objects: <span id="objects" class="objects">100</span>% (<span id="objects_p" class="objects">12</span>/12), done.<br/>'),e("#"+n+".response #objects").html(100),e("#"+n+".response #objects_p").html(12),e("#"+n+".response .objects").each(function(){e(this).prop("Counter",0).animate({Counter:e(this).text()},{duration:900,easing:"swing",step:function(t){e(this).text(Math.ceil(t))}})}),e("#"+n+".response .objects").promise().done(function(){e("#"+n+".response").append('<span id="down_c" class="down_class">Receiving objects: <span id="down_m" class="down">100</span>% (<span id="down_p" class="down">4643</span>/4643)  <span id="down_mb" class="down">28</span> MiB | <span id="down_k" class="down">167</span>  Kib/s, done. </span><br/> '),e("#"+n+".response #down_m").html(100),e("#"+n+".response #down_p").html(4643),e("#"+n+".response #down_mb").html(28),e("#"+n+".response #down_k").html(167),e("#"+n+".response .down").each(function(){e(this).prop("Counter",0).animate({Counter:e(this).text()},{duration:3e3,easing:"swing",step:function(t){e(this).text(Math.ceil(t))}})}),e("#"+n+".response .down").promise().done(function(){e("<span>remote: Total 4643 (delta 2), reused 0 (delta 0), pack-reused 4631</span><br/>").insertBefore("#"+n+".response #down_c.down_class"),e("#"+n+".response").append('Resolving deltas: <span id="delta" class="delta">100</span>% (<span id="delta_p"class="delta">2961</span>/2961), done.<br/>'),e("#"+n+".response #delta").html(100),e("#"+n+".response #delta_p").html(2961),e("#"+n+".response .delta").each(function(){e(this).prop("Counter",0).animate({Counter:e(this).text()},{duration:2e3,easing:"swing",step:function(t){e(this).text(Math.ceil(t))}})}),e("#"+n+".response .delta").promise().done(function(){e("#"+n+".response").append("Checking connectivity... done. <br/>"),e("#"+n+".response").append('Checking out files: <span id="files" class="files">100</span>% (<span id="files_p"class="files">975</span>/975), done.<br/>'),e("#"+n+".response #files").html(100),e("#"+n+".response #files_p").html(975),e("#"+n+".response .files").each(function(){e(this).prop("Counter",0).animate({Counter:e(this).text()},{duration:2e3,easing:"swing",step:function(t){e(this).text(Math.ceil(t))}})}),e("#"+n+".response .files").promise().done(function(){h.newline(t,n)})})})})}else e("#"+n+".response").html("fatal: repository '"+t.replace(/\s\s+/g," ")+"' does not exist"),h.newline("")},unSupportedCommand:function(t,n){var s=["mv"];for(i=0;i<s.length;i++)t==s[i]&&e("#"+n+".response").html("This is an emulator, not a shell. Try following the instructions.")}},g={gitClone:function(e){var t=/git\sclone\s(https:\/\/|git:\/\/)([a-zA-Z-.-_--]{0,}[^\/\/]\/){0,}[a-zA-Z-.-_--]{0,}(\.git|\.GIT)/;return t.test(e)},language:function(e){var t=/\.css/,n=/\.js/,s=/\.py/,o=/\.go/,i=/\.java/,a=/\.scala/,l=/\.rb/,c=/\.rs/,r=/\.haml/;return t.test(e)?"css":n.test(e)?"javascript":s.test(e)?"python":o.test(e)?"go":i.test(e)?"java":a.test(e)?"scala":l.test(e)?"ruby":c.test(e)?"rust":r.test(e)?"haml":"markup"}},f={showInfo:function(t,n){e("#"+t).html('<div id="modal" class="modalDialog"><div><a href="#close" title="Close" class="close">X</a>'+n+"</div></div>")},showImg:function(t,n){var s="";s="g"===n?"modalImgGDialog":"b"===n?"modalImgBDialog":"modalImgSDialog",e("#contentimgmodal").html('<div id="modal" class="modalDialog '+s+'"><div><a href="#close" title="Close" class="close">X</a><img class="imginmodal" src="'+t+'" /></div></div>')},close:function(){"#modal"==location.hash&&(location.hash="")}};e(n).on("click","#modal",function(){f.close()}),e(n).on("click","#modal div",function(e){e.stopPropagation()});var u={open:function(){e("#terminal").hide(),e("#editor-header-filename").html("File: "),e("#editor-content").html(""),e("#namefile-x").html(""),e("#command-x").hide(),e("#editor").show(),e("#editor-content").focus()},openFile:function(t){if(e("#terminal").hide(),e("#editor-content-parent").html(""),e("#editor-header-filename").html("File: "),e("#namefile-x").html(""),e("#editor").show(),h.newline(t),null!==localStorage.getItem(t)){var n=JSON.parse(localStorage.getItem(t));e("#editor-content-parent").html('<pre><code id="editor-content" contenteditable="false" style="outline-color:black" spellcheck="false" class="language-'+n.language+'"></code></pre>'),e("#editor-content").html(n.content.split("<br>").join("\n")),Prism.highlightElement(e("#editor-content")[0]),e("#editor-header-filename").html("File: "+t),e("#namefile-x").html(t)}else e("#editor-header-filename").html("File: "),e("#namefile-x").html("");e("#editor-content").focus(),e("#command-x").hide()}};localStorage.setItem("initup",0),localStorage.setItem("initdown",0),e(n).on("keydown",".textinline",function(t){var n=e(this).parent().get(0).id,s=localStorage.getItem("loghistory").split(",");if(s=s.filter(Boolean),38==t.which){var o=parseInt(localStorage.getItem("initup")),i=o+1;i>s.length-1?localStorage.setItem("initup",0):localStorage.setItem("initup",i),e("#"+n+".parent-textinline").children(".textinline").html(s[localStorage.getItem("initup")])}if(localStorage.setItem("total",s.length-1-parseInt(localStorage.getItem("initdown"))),40==t.which){var o=parseInt(localStorage.getItem("initdown")),o=o+1;localStorage.setItem("initdown",o),localStorage.getItem("total")==-1&&localStorage.setItem("initdown",0),e("#"+n+".parent-textinline").children(".textinline").html(s[localStorage.getItem("total")])}var a=new Array;if(a=localStorage.getItem("commands").split(","),9==t.which){for(var l=0;l<a.length;l++){var c=new RegExp("^"+a[l].substring(0,3));c.test(e(this).text())&&e("#"+n+".parent-textinline").children(".textinline").text(a[l])}t.preventDefault()}}),e(n).on("keydown","#editor-content",function(t){if(e("#editor-content").is(":visible")&&88==t.keyCode&&t.ctrlKey)return""!==e("#editor-content").text()?(e("#command-x").is(":visible")||(e("#commands").hide(),e("#command-save-x").show(),e("#q-save-x").focus()),!1):(e("#editor").hide(),e("#terminal").show(),e("#command-save-x").hide(),e(".textinline").focus(),!1)}),e("#q-save-x").keydown(function(t){e(this).html(""),89==t.which&&(e("#command-save-x").hide(),e("#command-x").show(),e("#commands").show(),e("#namefile-x").focus()),78==t.which&&(e("#command-save-x").hide(),e("#commands").show(),e("#editor").hide(),e("#terminal").show(),e(".textinline").focus()),89===t.which&&78===t.which||t.preventDefault()}),e(n).on("keydown","#command-save-x",function(t){e("#command-save-x").is(":visible")&&67==t.keyCode&&t.ctrlKey&&(e("#command-save-x").hide(),e("#commands").show())}),e(n).on("keydown","#namefile-x",function(t){if(13==t.keyCode){if(null!==localStorage.getItem(e(this).text())){var n=JSON.parse(localStorage.getItem(e(this).text()));localStorage.setItem(e(this).text(),JSON.stringify({content:e("#editor-content").html(),language:n.language}))}else localStorage.setItem(e(this).text(),JSON.stringify({content:e("#editor-content").html(),language:g.language(e(this).text())}));e("#editor").hide(),e("#terminal").show(),e(".textinline").focus();var s=localStorage.getItem("files").split(",");s=s.filter(Boolean);for(var o=0;o<s.length;o++){if(s[o]===e(this).text())return!1;checkDuplicate=!1}checkDuplicate||(s.push(e(this).text()),localStorage.setItem("files",s))}}),e(n).on("click","#namefile-x",function(t){e("#namefile-x").focus()}),e("#editor-content").click(function(){e(this).focus()}),e("#q-save-x").click(function(){e(this).focus()});var v={preLoad:function(t){if(""===t)localStorage.setItem("hello_world.py",JSON.stringify({content:'print "Hello World!"',language:"python"})),localStorage.setItem("files","hello_world.py");else{var n=[];e.ajaxSetup({async:!1}),""!==t&&(e.getJSON(t,function(t){e.each(t,function(e,t){n.push(t.name),localStorage.setItem(t.name,JSON.stringify({content:t.content.join(""),language:t.language===s?"markup":t.language}))})}),localStorage.setItem("files",n))}}};e(n).on("click",".btn-step",function(){var t=e(this).data("step");p.showInfo(t)}).on("mouseup",".btn-step",function(){var t=e(this).data("step");e("#"+t+".btn-step").css({"background-color":"#8F8F8F",color:"white",border:"1px solid #525252"}),e(this).css({"background-color":"#8F8F8F",color:"white",border:"1px solid #525252"})}),e(n).on("click","#skip",function(){p.skip(e(this).data("step"))}),e(n).on("click","#btn_next_finish",function(){var t=e(this).data("nextstep");p.showInfo(t),e("#"+t).removeClass("not-active")}),e(n).on("click",".modalimage",function(){f.showImg(e(this).data("image"),e(this).data("size"))}),e(n).on("click","#editor-content",function(){e(this).attr("contenteditable",!0)});var x=0;e(n).on("keydown",".textinline","[contenteditable]",function(t){if(13==t.keyCode){var n=e(this).text().trim();if(e(this).removeAttr("contenteditable"),e('<p id="'+x+'" class="response"></p>').appendTo("#"+x+".parent-textinline"),e("#"+x+".response").html('<pre><code id="'+x+'_lang_terminal" class="language-bash"></code></pre>'),localStorage.getItem("commandStepsFile")?null!==localStorage.getItem(n)&&(Prism.highlightElement(e("#"+x+"_lang_terminal")[0]),e("#"+x+"_lang_terminal").html(h.result(n,x+1))):n.replace(/\s\s+/g," ")!=="git clone "+n.split(" ").pop()&&(e("#"+x+".response").html(""),h.newline(n,x+1)),e("#"+x+".cline").length>0&&(e("#"+x+".cline").css({display:"none"}),e.each(e("#"+x+".cline"),function(t,n){e(n).delay(400*t).fadeIn("slow")}).promise().done(function(){h.newline(n,x+1)})),x++,n.replace(/\s\s+/g," ")=="git clone "+n.split(" ").pop()?(h.gitClone(n,x-1),console.log("here...")):"ls"==n.toLowerCase()?(h.ls(x-1),h.newline(n,x)):"clear"==n.toLowerCase()?(h.clear(n,x),x=0):h.newline(n,x),n.replace(/\s\s+/g," ")=="rm -r "+n.split(" ").pop()&&h.rm(n.split(" ").pop()),"nano"==n&&(e("#"+x+".response").html(""),u.open()),n.replace(/\s\s+/g," ")=="nano "+n.split(" ").pop()){e("#"+x+".response").html("");var s=n.split(" ").pop();u.openFile(s)}}});var S="cli_guide",w={welcomeMessage:"Welcome to the interactive tutorial",nameOfTheProject:"CLI-Guide.JS",heightTerminal:t.innerHeight-30,commandStepsFile:"",commandValidation:"",preloadfile:"",stepsFile:"",skipsteps:"",labels:{next:"Next",skip:"Skip"}};c.prototype.init=function(){var t=this.options;e(this.element).html('<div class="container-fluid"><div class="row"><div id="steps_section" class="col-xs-4"><div class="row steps-numbers-section"><div class="col-xs-12"><ul id="listofsteps"></ul></div></div><div id="steps_section_content"><div id="steptitle"></div><div id="stepscontent"></div><div id="moreinfo"></div><br/><br/></div></div><div id="terminal_section" class="col-xs-8"><div class="row"><div id="terminal-parent" class="col-xs-12"><div id="terminal-header" class="col-xs-12"><ul id="terminal-header-buttons"><li id="hbtn-close"></li><li id="hbtn-min"></li><li id="hbtn-max"></li></ul></div><div id="terminal" class="col-xs-12 heightTerminal"></div></div></div><div id="editor-parent" class="row"><div id="editor" class="col-xs-12 heightTerminal"><div id="editor-header" class="row"><div id="editor-header-title" class="col-xs-3">GNU nano 2.2.6</div><div id="editor-header-filename" class="col-xs-9">New Buffer</div></div><div class="row"><div id="editor-content-parent"><pre><code id="editor-content" class="col-xs-12" style="outline-color:black" contenteditable="true" spellcheck="false" id="lang" class="language-markup"></code></pre></div></div><div class="row"><div id="editor-commands" class="col-xs-12"><div id="command-save-x"><div class="row"><div id="message-save-x" class="col-xs-7">Save modified buffer (ANSWERING "No" WILL DESTROY CHANGES) ?</div><div id="q-save-x" class="col-xs-5" contenteditable="true"></div></div><div class="row"><div class="col-xs-2"><span class="editor-command">&nbsp;Y</span> Yes</div></div><div class="row"><div class="col-xs-2"><span class="editor-command">&nbsp;N</span> No</div><div class="col-xs-2"><span class="editor-command">^C</span> Cancel</div></div></div><div id="command-x" class="row"><div id="message-x" class="col-xs-3">File Name to Write:</div><div id="namefile-x" class="col-xs-9" contenteditable="true"></div></div><div id="commands"><div class="row"><div class="col-xs-2"><span class="editor-command">^G</span> Get Help</div><div class="col-xs-2"><span class="editor-command">^O</span> WriteOut</div><div class="col-xs-2"><span class="editor-command">^R</span> Read File</div><div class="col-xs-2"><span class="editor-command">^Y</span> Prev Page</div><div class="col-xs-2"><span class="editor-command">^K</span> Cut Text</div><div class="col-xs-2"><span class="editor-command">^C</span> Cur Pos</div></div><div class="row"><div class="col-xs-2"><span class="editor-command">^X</span> Exit</div><div class="col-xs-2"><span class="editor-command">^J</span> Justify</div><div class="col-xs-2"><span class="editor-command">^W</span> Where is</div><div class="col-xs-2"><span class="editor-command">^V</span> Next Page</div><div class="col-xs-2"><span class="editor-command">^U</span> UnCut Text</div><div class="col-xs-2"><span class="editor-command">^T</span> To Speel</div></div></div></div></div></div></div></div></div></div>'),e(".heightTerminal").css("height",t.heightTerminal+"px"),e("#editor").hide(),e("#terminal").append('<div class="line">'+d.insertAt(t.welcomeMessage,27,t.nameOfTheProject)+"</div>"),e("#terminal").append("<br/>");var n=t.heightTerminal-e("#editor-commands").height()-e("#editor-header").height()-100,s=n;e("#editor-content-parent").css("height",n+"px"),e("#editor-content").css("height",s+"px"),e("#command-x").hide(),e("#command-save-x").hide(),localStorage.setItem("idinput",0),localStorage.setItem("actualdir",""),localStorage.setItem("skipsteps",""),h.newline("",0),p.clean(t.commandStepsFile),l(t.commandStepsFile),a(t.commandStepsFile),v.preLoad(t.preloadfile),p.list(t.stepsFile),p.getLast(t.stepsFile),m.loadSteps(t.stepsFile),m.loadCommands(t.commandStepsFile),""!==t.skipsteps&&localStorage.setItem("skipsteps",t.skipsteps),p.showInfo(1)},e.fn[S]=function(t){return this.each(function(){e.data(this,"plugin_"+S)||e.data(this,"plugin_"+S,new c(this,t))})}}(jQuery,window,document);